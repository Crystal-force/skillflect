// const { sum } = require("lodash");

! function (e) {
	"use strict";
  var a, r = {}, d = [], color = [];

  //https://stackoverflow.com/questions/19491336/how-to-get-url-parameter-using-jquery-or-plain-javascript

// This Week Chart page

let class_weekchart = $("#class_monthid").val();
let class_stdid = $('#profile_username').attr('data-id');
$.ajax({
  url: '/class_monthchart',
  method: 'POST',
  data: {send_chartid:class_weekchart, send_id:class_stdid},
  dataType: 'json',
  async: false,
  success:function(data){
    let count = data.array.length;
    // console.log(data.array);
    let calue;
      if(count == '0'){
        $("#month_notification").delay(5).fadeIn('slow').delay(1500).fadeOut('slow');
      }
      else{
        for(let i=0; i<count; i++){
            calue = parseFloat(data.array[i].val/data.sum *100).toFixed(2);
            d.push({value: calue, label: data.array[i].name});
            color.push(getColor());
          }
      }
    }
});

  initChart_ClassMonth();

  function initChart_ClassMonth() {
    r = Morris.Donut({
      element: "donut-morris-chart-classmonth",
      data: d,
      colors: color,
      resize: !0,
      formatter: function (e) {
        return e + "%"
      }
    })
  }
  
  function getColor() {
    const randomColor = Math.floor(Math.random()*16777215).toString(16);
    if(randomColor == "#ddd") {return;}
    else{
      document.body.style.backgroundColor = "#" + randomColor;
      return "#" + randomColor;
    }
  }

$('#class_monthid').change(function(){
    $("#donut-morris-chart-classmonth").empty();
    let chart_sbj=$(this).find(':selected').data('id');
    let stdchart_id = $('#profile_username').attr('data-id');
    $.ajax({
      url: '/class_selectmonthdata',
      method: 'POST',
      data: {send_selectid:chart_sbj, send_selid:stdchart_id},
      dataType: 'json',
      async: false,
      success:function(data){
        console.log(data.array.length);
        let count = data.array.length;
        let calue; d = []; color = [];

        if(count == '0'){
          $("#month_notification").delay(5).fadeIn('slow').delay(1500).fadeOut('slow');
        }
        else{
        for(let i=0; i<count; i++){
            calue = parseFloat(data.array[i].val/data.sum *100).toFixed(2);
            d.push({value: calue, label: data.array[i].name});
            color.push(getColor());
          }
        }
        initChart_ClassMonth();
      }
    });
  });
}(jQuery);

