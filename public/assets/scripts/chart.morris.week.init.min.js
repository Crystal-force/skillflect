// const { sum } = require("lodash");

! function (e) {
	"use strict";
  var a, r = {}, d = [], color = [];

  //https://stackoverflow.com/questions/19491336/how-to-get-url-parameter-using-jquery-or-plain-javascript

// This Week Chart page
let week_chart = $("#chart_weekid").val();
let stdchart_id = $('#profile_username').attr('data-id');
$.ajax({
  url: '/chart_weekdata',
  method: 'POST',
  data: {send_chartid:week_chart, send_id:stdchart_id},
  dataType: 'json',
  async: false,
  success:function(data){
    let count = data.array.length;
    console.log(count);
    let calue;
      if(count == '0'){
        $("#week_result").delay(5).fadeIn('slow').delay(1500).fadeOut('slow');
      }
      else{
        for(let i=0; i<count; i++){
            calue = parseFloat(data.array[i].val/data.sum *100).toFixed(2);
            d.push({value: calue, label: data.array[i].name});
            color.push(getColor());
          }
      }
    }
});

  initChart_week();

  function initChart_week() {
    r = Morris.Donut({
      element: "donut-morris-chart-week",
      data: d,
      colors: color,
      resize: !0,
      formatter: function (e) {
        return e + "%"
      }
    })
  }
  
  function getColor() {
    const randomColor = Math.floor(Math.random()*16777215).toString(16);
    if(randomColor == "#ddd") {return;}
    else{
      document.body.style.backgroundColor = "#" + randomColor;
      return "#" + randomColor;
    }
  }

$('#chart_weekid').change(function(){
    $("#donut-morris-chart-week").empty();
    let chart_sbj=$(this).find(':selected').data('id');
    let stdchart_id = $('#profile_username').attr('data-id');
    $.ajax({
      url: '/week_selectdata',
      method: 'POST',
      data: {send_selectid:chart_sbj, send_selid:stdchart_id},
      dataType: 'json',
      async: false,
      success:function(data){
        console.log(data.array.length);
        let count = data.array.length;
        let calue; d = []; color = [];

        if(count == '0'){
          $("#week_result").delay(5).fadeIn('slow').delay(1500).fadeOut('slow');
        }
        else{
        for(let i=0; i<count; i++){
            calue = parseFloat(data.array[i].val/data.sum *100).toFixed(2);
            d.push({value: calue, label: data.array[i].name});
            color.push(getColor());
          }
        }
        initChart_week();

      }
    });
  });
}(jQuery);

