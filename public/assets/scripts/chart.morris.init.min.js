// const { sum } = require("lodash");

! function (e) {
	"use strict";
  var a, r = {}, d = [], color = [];
  
  let all_chart=$('#chart_subid').val();
  let stdchart_id = $('#profile_username').attr('data-id');
  $.ajax({
    url: '/chart_alldata',
    method: 'POST',
    data: {send_chartid:all_chart, send_id:stdchart_id},
    dataType: 'json',
    async: false,
    success:function(data){
      let count = data.array.length;
      let calue;
      for(let i=0; i<count; i++){
          calue = parseFloat(data.array[i].val/data.sum *100).toFixed(2);
          d.push({value: calue, label: data.array[i].name});
          color.push(getColor());
        }
    }
  });

  //https://stackoverflow.com/questions/19491336/how-to-get-url-parameter-using-jquery-or-plain-javascript


  initChart();

  function initChart() {
    r = Morris.Donut({
      element: "donut-morris-chart-all",
      data: d,
      colors: color,
      resize: !0,
      formatter: function (e) {
        return e + "%"
      }
    })
  }
  
  function getColor() {
    const randomColor = Math.floor(Math.random()*16777215).toString(16);
    if(randomColor == "#ddd") {return;}
    else{
      document.body.style.backgroundColor = "#" + randomColor;
      return "#" + randomColor;
    }
  }

$('#chart_subid').change(function(){
    $("#donut-morris-chart-all").empty();
    let chart_sbj=$(this).find(':selected').data('id');
    let stdchart_id = $('#profile_username').attr('data-id');
    $.ajax({
      url: '/chart_selectdata',
      method: 'POST',
      data: {send_selectid:chart_sbj, send_selid:stdchart_id},
      dataType: 'json',
      async: false,
      success:function(data){
        let count = data.array.length;
        let calue; d = []; color = [];

        if(count == '0'){
          $("#chart_result").delay(5).fadeIn('slow').delay(1500).fadeOut('slow');
        }
        else{
        for(let i=0; i<count; i++){
            calue = parseFloat(data.array[i].val/data.sum *100).toFixed(2);
            d.push({value: calue, label: data.array[i].name});
            color.push(getColor());
          }
        }
        initChart();

      }
    });
  });
}(jQuery);


function TotalDataView(){
  let user_id = $("#profile_username").attr('data-id');
  $(".detail-table").fadeIn();
  $.ajax({
    url:'/totaldataview',
    method: 'POST',
    data:{send_nserid:user_id},
    dataType:'json',
    async:false,
    success:function(data){
      let count = data.data.length;
      let total_data = '';
      for(let i=0; i<count; i++){
        total_data +='<tr>\n'+ 
                      '<td>'+data.data[i].datetime+'</td>\n'+
                      '<td>'+data.data[i].skillname+'</td>\n'+
                      '<td>'+data.data[i].skilloptionoption_name+'</td>\n'+
                      '<td>'+data.data[i].used+'</td>\n'+
                     '</tr>';
      }
      $("#detail_data").html(total_data);
    }
  });
}
function Close_Table(){
  $(".detail-table").hide();
}